<!DOCTYPE html>
<html>
	<head>
		<title>MY BLOG</title>
		<meta charset="utf-8" />
		<link rel="stylesheet" type="text/css" href="../styles/main.css" />
		<link rel="stylesheet" type="text/css" href="../styles/demo.css" />
	</head>
	<body>
		<div class="wrapper">
			<div class="container">
				<div class="primary">
					<div class="header">
						<h1><a href="index.html"><span>ZHRJ</span>博客</a></h1>
						<p>博客园：<a href="http://www.cnblogs.com/zhrj000/" title="去看看">http://www.cnblogs.com/zhrj000/</a></p>
						<ul class="nav">
                            <li><a href="../index.html">首页</a></li>
                            <li><a href="../demo.html">demo</a></li>
                            <li><a href="../rebuild.html">网页重构</a></li>
                            <li><a href="../aboutjs.html">javascript</a></li>
                            <li><a href="../aboutme.html">关于我</a></li>
                        </ul>
					</div>
					<div class="sider">
						<div class="sider-box blog-box">
							<h4>关注的博客</h4>
							<ul>
								<li><a href="http://www.zhangxinxu.com/wordpress/">张鑫旭博客</a></li>
								<li><a href="http://www.cssforest.org/blog/">CSS森林</a></li>
								<li><a href="http://coolshell.cn/">酷壳</a></li>
								<li><a href="http://www.qianduan.net/">前端观察</a></li>
							</ul>
						</div>
						<div class="sider-box paper-box">
							<h4>收藏的文章</h4>
							<ul>
								<li><a href="https://github.com/lifesinger/lifesinger.github.com/issues/105">最牛逼的 HTML 和 CSS 代码的背后</a></li>
								<li><a href="http://www.zhangxinxu.com/wordpress/2012/07/bottleneck-css-study/">说说CSS学习中的瓶颈</a></li>
							</ul>
						</div>
						<div class="sider-box me-box">
							<h4>联系我</h4>
							<ul>
								<li>博客园：<a href="http://www.cnblogs.com/zhrj000/">http://www.cnblogs.com/zhrj000/</a></li>
								<li>新浪微博：<a href="http://weibo.com/inthecorner">http://weibo.com/inthecorner</a></li>
								<li>网易邮箱：<a href="http://mail.163.com/">zhrj000@163.com</a></li>
							</ul>
						</div>
					</div>
				</div>
				<div class="content">
					<div class="article">
						<h2>关于js的mouseout</h2>
						<p class="posttime">——发表于2012/10/11 </p>
						<p>1)最近在写菜单栏的时候，用到了js的mouseover事件，发现了一些问题。</p>
						<p>当添加事件的容器里面没有其他任何子容器的时候，一切就正常</p>
						<p><img src="../images/121011-1.jpg" /></p>
						<p>但是呢，如果父容器里面有子容器，那么鼠标在子容器间切换移动的时候都会触发原本是添加在父容器上的mouseout事件（即使只是在子容器间移动，并没有out出父容器）</p>
						<p><img src="../images/121011-2.jpg" /></p>
						<p>2)一开以为是事件冒泡的问题，但后来测试后发现好像不是。</p>
						<p>猜测：虽然事件添加在currentTarget上，但是currentTarget只是被注册事件监听器的对象，target才是真正的事件，所以是target触发了事件，所以才有了上面#top 跟#bottom触发了mouseout事件</p>
						<p>3）所以，解决的方法就是判断relatedTarget对象是否是currentTarget的子节点或者本身，如果不是，才放置触发要做的事件</p>
						<p><img src="../images/121011-3.jpg" /></p>
						<p>4）以下为测试所用代码（解决这个问题的时候，上网查，看的是这篇文章<a href="http://www.qiqiboy.com/2011/01/19/javascript-mouseover-and-mouseout.html">http://www.qiqiboy.com/2011/01/19/javascript-mouseover-and-mouseout.html</a>，不过里面有些些地方不是很赞同，我的测试代码其实就是参考他的代码的 ）</p>
<pre>
&lt;!DOCTYPE html&gt;
 &lt;html&gt;
     &lt;head&gt;
         &lt;title&gt;aboutMouseout&lt;/title&gt;
         &lt;meta charset="utf-8" /&gt;
         &lt;style type="text/css"&gt;
             body{
                 margin: 0;
                 padding: 0;
             }
             #container{
                 height: 200px;
                 width: 200px;
                 background-color: red;
                 color:white;
                 font-size: 20px;
                 font-weight: bold;
                 text-align: center;
             }
             #top{
                 height: 60px;
                 width: 200px;
                 padding-top: 40px;
                 background-color: green;
             }
             #bottom{
                 height: 60px;
                 width: 200px;
                 padding-top: 40px;
                 background-color: blue;
             }
         &lt;/style&gt;
     &lt;/head&gt;
     &lt;body&gt;
         &lt;div id="container"&gt;
             &lt;div id="top"&gt;top &lt;/div&gt;
             &lt;div id="bottom"&gt;bottom &lt;/div&gt;
         &lt;/div&gt;
         &lt;script type="text/javascript"&gt;
             var EventUtil = {
                     addHandler: function (element, type, handler) {
                         if (element.addEventListener) {
                             element.addEventListener(type, handler, false);
                         } else if (element.attachEvent) {
                             element.attachEvent("on" + type, handler);
                         } else {
                             element["on" + type] = handler;
                         }
                     },
                     getEvent: function (event) {
                         return event ? event : window.event;
                     },
                     getTarget: function (event) {
                         return event.target || event.srcElement;
                     },
                     getRelatedTarget: function (event) {
                         if (event.relatedTarget) {
                             return event.relatedTarget;
                         } else if (event.toElement) {
                             return event.toElement;
                         } else if (event.formElement) {
                             return event.formElement;
                         } else {
                             return null;
                         }
                     }
                 }
                 //返回值布尔值，判断childNode是否是parentNode的子节点
                 function contains(parentNode,childNode){
                     if(typeof parentNode.contains==="function"){
                         return parentNode.contains(childNode);
                     }else if(typeof parentNode.compareDocumentPosition==="function"){
                         return !!(parentNode.compareDocumentPosition(childNode)&16);
                     }else{
                         var node=childNode.parentNode;
                         do{
                             if(node===parentNode){
                                 return true;
                             }else{
                                 node=node.parentNode;
                             }
                         }while(node!==null);
                         return false;
                     }
                 }
                    //返回值布尔值，判断是否触发事件
                 function fixedMouse(event,element){
                     event=EventUtil.getEvent(event);
                     var related,
                         type=event.type.toLowerCase();
                     if(type==="mouseover"||type==="mouseout"){
                         related=EventUtil.getRelatedTarget(event);
                     }else return true;
                     console.log("relatedTarget对象为：#"+related.id);
                     return related && related.prefix!='xul' && 
　　　　　　　　　　　　　　!contains(element,related) && related!==element;
                 }
                 EventUtil.addHandler(document.getElementById("container"),"mouseout",function(event){
                     event=EventUtil.getEvent(event);
                     var target=EventUtil.getTarget(event),
                         currentTarget=event.currentTarget;
                     if(fixedMouse(event,this)){
                         //放置触发事件
                         console.log(event.type+"事件被触发\n"+"事件处于(1、捕获阶段，2、目标对象，3、冒泡阶段)："+
　　　　　　　　　　　　　　　　 event.eventPhase+"\n事件的实际目标target：#"+target.id+
　　　　　　　　　　　　　　　　 "\n事件的this对象currentTarget：#"+currentTarget.id);
                     }else{
                         //不放置触发事件
                         console.log("不是currentTarget对象不放置触发事件\n");
                     }
                     
                 });
         &lt;/script&gt;
     &lt;/body&gt;
 &lt;/html&gt;</pre>

					</div>
				</div>
			</div>
			<div class="footer">Copyright © 2012 <a href="http://zhrj000.github.com/">zhrj000.github.com</a> All rights reserved.</div>
		</div>
	</body>
</html>